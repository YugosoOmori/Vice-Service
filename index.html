<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vice Service | Tech Solutions</title>
    <style>
        :root { --primary: #8a2be2; --secondary: #00d4ff; --bg: #0a0a0a; --card: #121212; --admin: #ff4757; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: white; scroll-behavior: smooth; overflow-x: hidden; }
        
        header { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(10, 10, 10, 0.98); position: fixed; width: 90%; top: 0; z-index: 1000; border-bottom: 1px solid #222; }
        .logo { font-size: 20px; font-weight: 900; color: var(--primary); letter-spacing: 1px; }
        nav a { margin-left: 15px; color: white; text-decoration: none; cursor: pointer; font-size: 13px; }
        
        /* Floating WhatsApp Button */
        .wa-float { position: fixed; bottom: 20px; left: 20px; background: #25d366; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 2500; text-decoration: none; transition: 0.3s; }
        .wa-float:hover { transform: scale(1.1); }

        #statusToast { position: fixed; bottom: 20px; right: 20px; background: var(--secondary); color: #000; padding: 15px 25px; border-radius: 12px; font-weight: 800; display: none; z-index: 3000; box-shadow: 0 10px 30px rgba(0,212,255,0.3); animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .hero { text-align: center; padding: 150px 10% 60px; background: radial-gradient(circle at top, #1a1a2e 0%, #0a0a0a 100%); }
        .hero h1 { font-size: 2.5rem; margin: 0; background: linear-gradient(to right, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .services { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; padding: 40px 5%; }
        .price-card { background: var(--card); padding: 30px 20px; border-radius: 20px; border: 1px solid #222; text-align: center; transition: 0.3s; }
        .price-card:hover { border-color: var(--primary); transform: translateY(-5px); }
        .price-card .cost { font-size: 2.2rem; font-weight: 800; color: var(--secondary); margin: 15px 0; }

        .reviews-section { padding: 60px 5%; background: #080808; }
        .review-box { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #222; }
        .review-img { width: 100%; max-height: 250px; object-fit: cover; border-radius: 12px; margin-top: 12px; border: 1px solid #333; }
        .review-form { background: #111; padding: 20px; border-radius: 20px; margin-bottom: 30px; border: 1px solid var(--primary); display: none; }

        #imgPreview { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; display: none; margin: 10px 0; border: 1px solid var(--primary); }
        .panel { background: #111; padding: 25px; border-radius: 20px; border: 1px solid var(--primary); margin: 100px 5% 20px; display: none; }
        .btn-p { background: var(--primary); color: white; border: none; padding: 14px; cursor: pointer; font-weight: bold; border-radius: 8px; width: 100%; transition: 0.3s; margin-top: 10px; }
        
        #authModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:2000; justify-content:center; align-items:center; padding: 20px; }
        .modal-content { background:#161616; padding:30px; border-radius:24px; border: 1px solid #333; width:100%; max-width:320px; text-align:center; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #555; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: white; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        
        @media (max-width: 600px) { .hero h1 { font-size: 1.8rem; } header { width: 100%; padding: 15px 15px; box-sizing: border-box; } }
    </style>
</head>
<body>

<div id="statusToast">‚úÖ Comanda ta este Gata!</div>

<a href="https://wa.me/0786047803" class="wa-float" target="_blank">üí¨</a>

<header>
    <div class="logo">VICE SERVICE</div>
    <nav>
        <a href="#services">Servicii</a>
        <a href="#reviews">Recenzii</a>
        <a onclick="window.openModal()" id="loginNavBtn" style="color: var(--primary); border: 1px solid; padding: 4px 10px; border-radius: 5px;">Login / Recenzii</a>
    </nav>
</header>

<div class="panel" id="adminPanel" style="border-color: var(--admin);">
    <h2 style="color: var(--admin); font-size: 1.2rem;">Admin: Panou Comenzi</h2>
    <div id="adminOrderList"></div>
    <button onclick="window.logOut()" style="color:#666; background:none; border:none; cursor:pointer; margin-top:20px;">Logout</button>
</div>

<div class="panel" id="userDash">
    <h2 id="greetText">Salut!</h2>
    <div id="userOrderStatus"></div>
    <button onclick="window.logOut()" style="color:#666; background:none; border:none; cursor:pointer; margin-top:15px;">Logout</button>
</div>

<section class="hero">
    <h1>Hardware Solutions.</h1>
    <p>Repara»õii profesionale. ComandƒÉ direct pe WhatsApp.</p>
</section>

<section class="services" id="services">
    <div class="price-card"><h3>Schimb Baterie</h3><div class="cost">75 <span>RON</span></div><button class="btn-p" onclick="window.placeOrder('Schimb Baterie')">ComandƒÉ Acum</button></div>
    <div class="price-card"><h3>Schimb Ecran</h3><div class="cost">100 <span>RON</span></div><button class="btn-p" onclick="window.placeOrder('Schimb Ecran')">ComandƒÉ Acum</button></div>
    <div class="price-card"><h3>Mentenan»õƒÉ PC</h3><div class="cost">150 <span>RON</span></div><button class="btn-p" onclick="window.placeOrder('Mentenan»õƒÉ PC')">ComandƒÉ Acum</button></div>
</section>

<section class="reviews-section" id="reviews">
    <h2 style="text-align: center; margin-bottom: 30px;">Recenzii</h2>
    <div id="reviewForm" class="review-form">
        <h3>AdaugƒÉ Recenzia Ta</h3>
        <select id="revStars"><option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option></select>
        <textarea id="revText" placeholder="Cum a decurs repara»õia?"></textarea>
        <label style="font-size: 12px; color: var(--secondary); cursor: pointer;">+ AdaugƒÉ PozƒÉ<input type="file" id="revImg" accept="image/*" style="display:none;" onchange="window.previewImage(this)"></label>
        <center><img id="imgPreview"></center>
        <button class="btn-p" id="postBtn" onclick="window.postReview()">PosteazƒÉ</button>
    </div>
    <div id="reviewsList"></div>
</section>

<div id="authModal">
    <div class="modal-content">
        <span class="close-btn" onclick="window.closeModal()">&times;</span>
        <h2 id="m-title">Autentificare</h2>
        <input type="text" id="regUser" placeholder="Nume Complet" style="display:none;">
        <input type="email" id="uEmail" placeholder="Email">
        <input type="password" id="uPass" placeholder="Parola">
        <button class="btn-p" id="m-btn" onclick="window.handleAuth()">IntrƒÉ √Æn cont</button>
        <p id="m-toggle" style="font-size:12px; color:var(--secondary); cursor:pointer; margin-top:15px;" onclick="window.toggleAuth()">Nu ai cont? CreeazƒÉ unul</p>
        <p onclick="window.resetPass()" style="font-size:11px; color:#ff4757; cursor:pointer; margin-top:10px;">Ai uitat parola?</p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, onSnapshot, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB9xuQD_cvxult5OoRqnrxFbnV4GRqKyNY",
  authDomain: "vice-service.firebaseapp.com",
  projectId: "vice-service",
  storageBucket: "vice-service.firebasestorage.app",
  messagingSenderId: "17358293881",
  appId: "1:17358293881:web:7691b91c7d7f0a65bffda8",
  measurementId: "G-20WM0K9WBL"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let isSignUp = false;
    let currentUserData = null;

    window.openModal = () => document.getElementById('authModal').style.display = 'flex';
    window.closeModal = () => document.getElementById('authModal').style.display = 'none';

    window.toggleAuth = () => {
        isSignUp = !isSignUp;
        document.getElementById('m-title').innerText = isSignUp ? "Cont Nou" : "Autentificare";
        document.getElementById('regUser').style.display = isSignUp ? "block" : "none";
        document.getElementById('m-btn').innerText = isSignUp ? "CreeazƒÉ Cont" : "IntrƒÉ √Æn cont";
    };

    window.resetPass = async () => {
        const email = document.getElementById('uEmail').value;
        if(!email) return alert("Scrie email-ul!");
        await sendPasswordResetEmail(auth, email);
        alert("Link trimis pe email!");
    };

    window.handleAuth = async () => {
        const email = document.getElementById('uEmail').value;
        const pass = document.getElementById('uPass').value;
        const username = document.getElementById('regUser').value;
        try {
            if (isSignUp) {
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await setDoc(doc(db, "users", res.user.uid), { username });
            } else { await signInWithEmailAndPassword(auth, email, pass); }
            window.closeModal();
        } catch (e) { alert(e.message); }
    };

    window.logOut = () => signOut(auth).then(() => location.reload());

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const snap = await getDoc(doc(db, "users", user.uid));
            currentUserData = snap.exists() ? snap.data() : { username: "Client" };
            document.getElementById('loginNavBtn').style.display = 'none';
            document.getElementById('reviewForm').style.display = 'block';
            if (user.email === "mariooncica@yahoo.com") showAdmin();
            else {
                document.getElementById('userDash').style.display = 'block';
                document.getElementById('greetText').innerText = "Salut, " + currentUserData.username;
                listenToMyOrder(user.uid);
            }
        }
        loadReviews();
    });

    function listenToMyOrder(uid) {
        onSnapshot(doc(db, "orders", uid), (d) => {
            if (d.exists()) {
                const o = d.data();
                const statusDiv = document.getElementById('userOrderStatus');
                statusDiv.innerHTML = `<p style="font-size:13px; color:#888;">Status ComandƒÉ: <b style="color:var(--secondary)">${o.status}</b></p>`;
                if(o.status === "Gata") {
                    const toast = document.getElementById('statusToast');
                    toast.style.display = 'block';
                    setTimeout(() => { toast.style.display = 'none'; }, 5000);
                }
            }
        });
    }

    // UPDATED PLACE ORDER LOGIC
    window.placeOrder = async (type) => {
        let name = currentUserData ? currentUserData.username : prompt("Numele tƒÉu:");
        if(!name) return;
        const orderId = auth.currentUser ? auth.currentUser.uid : "g_" + Date.now();
        await setDoc(doc(db, "orders", orderId), { type, username: name, status: "√én Lucru", timestamp: Date.now() });
        
        const message = encodeURIComponent(`Salut! Sunt ${name} »ôi vreau: ${type}`);
        window.open(`https://wa.me/0786047803?text=${message}`, '_blank');
    };

    window.previewImage = (input) => {
        const reader = new FileReader();
        reader.onload = (e) => { 
            const img = document.getElementById('imgPreview');
            img.src = e.target.result; 
            img.style.display = 'block'; 
        };
        reader.readAsDataURL(input.files[0]);
    };

    window.postReview = async () => {
        const text = document.getElementById('revText').value;
        const stars = document.getElementById('revStars').value;
        const file = document.getElementById('revImg').files[0];
        if(!text) return;
        document.getElementById('postBtn').innerText = "Se √ÆncarcƒÉ...";
        if(file) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = async () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 600;
                    const scaleSize = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scaleSize;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    await saveReview(text, stars, canvas.toDataURL('image/jpeg', 0.6));
                };
            };
        } else { await saveReview(text, stars, ""); }
    };

    async function saveReview(text, stars, img) {
        await addDoc(collection(db, "reviews"), { username: currentUserData.username, text, stars, img, timestamp: Date.now() });
        location.reload();
    }

    function loadReviews() {
        onSnapshot(query(collection(db, "reviews"), orderBy("timestamp", "desc")), (snap) => {
            const list = document.getElementById('reviewsList');
            list.innerHTML = "";
            snap.forEach(d => {
                const r = d.data();
                list.innerHTML += `<div class="review-box">
                    <div style="color:var(--secondary)">${"‚≠ê".repeat(r.stars)}</div>
                    <p style="margin:10px 0;">${r.text}</p>
                    ${r.img ? `<img src="${r.img}" class="review-img">` : ''}
                    <div style="font-size:11px; margin-top:10px; color:#444;">- ${r.username}</div>
                </div>`;
            });
        });
    }

    function showAdmin() {
        document.getElementById('adminPanel').style.display = 'block';
        onSnapshot(collection(db, "orders"), (snap) => {
            const list = document.getElementById('adminOrderList');
            list.innerHTML = "";
            snap.forEach(d => {
                const o = d.data();
                list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #222; display:flex; justify-content:space-between; align-items:center;">
                    <span>${o.username}: <b>${o.type}</b></span>
                    <button onclick="window.finish('${d.id}')" style="background:var(--secondary); border:none; padding:5px 10px; border-radius:4px; font-weight:bold; cursor:pointer;">OK (GATA)</button>
                </div>`;
            });
        });
    }

    window.finish = async (id) => { await updateDoc(doc(db, "orders", id), { status: "Gata" }); };
</script>
</body>
</html>
