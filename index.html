<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vice Service | Tech Solutions</title>
    <style>
        :root { --primary: #8a2be2; --secondary: #00d4ff; --bg: #0a0a0a; --card: #121212; --admin: #ff4757; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: white; scroll-behavior: smooth; }
        
        header { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(10, 10, 10, 0.98); position: fixed; width: 90%; top: 0; z-index: 1000; border-bottom: 1px solid #222; }
        .logo { font-size: 22px; font-weight: 900; color: var(--primary); letter-spacing: 1px; }
        nav a { margin-left: 20px; color: white; text-decoration: none; cursor: pointer; font-size: 14px; }
        
        .hero { text-align: center; padding: 180px 10% 80px; background: radial-gradient(circle at top, #1a1a2e 0%, #0a0a0a 100%); }
        .hero h1 { font-size: 3.5rem; margin: 0; background: linear-gradient(to right, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .services { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 25px; padding: 50px 10%; }
        .price-card { background: var(--card); padding: 40px 30px; border-radius: 20px; border: 1px solid #222; text-align: center; transition: 0.4s; }
        .price-card:hover { border-color: var(--primary); transform: translateY(-5px); }
        .price-card .cost { font-size: 2.5rem; font-weight: 800; color: var(--secondary); margin: 20px 0; }

        /* Review Section Styles */
        .reviews-section { padding: 80px 10%; background: #080808; }
        .review-box { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #222; }
        .review-form { background: #111; padding: 30px; border-radius: 20px; margin-bottom: 40px; border: 1px solid var(--primary); display: none; }
        .stars { color: #f1c40f; margin-bottom: 10px; }

        .panel { background: #111; padding: 40px; border-radius: 20px; border: 1px solid var(--primary); margin: 120px 10% 20px; display: none; }
        .btn-p { background: var(--primary); color: white; border: none; padding: 14px; cursor: pointer; font-weight: bold; border-radius: 8px; width: 100%; transition: 0.3s; margin-top: 10px; }
        .btn-p:hover { opacity: 0.8; }

        #authModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; justify-content:center; align-items:center; }
        .modal-content { background:#161616; padding:40px; border-radius:24px; border: 1px solid #333; width:320px; text-align:center; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #555; }
        
        input, textarea, select { width: 100%; padding: 15px; margin: 10px 0; background: #000; border: 1px solid #333; color: white; border-radius: 10px; box-sizing: border-box; }
        
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; border: 1px solid; }
        .bg-work { color: var(--secondary); border-color: var(--secondary); }
        .bg-done { color: #2ecc71; border-color: #2ecc71; }
    </style>
</head>
<body>

<header>
    <div class="logo">VICE SERVICE</div>
    <nav>
        <a href="#services">Servicii</a>
        <a href="#reviews">Recenzii</a>
        <a onclick="window.openModal()" id="loginNavBtn" style="color: var(--primary); border: 1px solid; padding: 5px 15px; border-radius: 5px;">Cont Client</a>
    </nav>
</header>

<div class="panel" id="adminPanel" style="border-color: var(--admin);">
    <h2 style="color: var(--admin);">Admin Panel</h2>
    <div id="adminOrderList"></div>
    <button onclick="window.logOut()" style="color:#555; background:none; border:none; cursor:pointer; margin-top:20px;">Logout</button>
</div>

<div class="panel" id="userDash">
    <h2 id="greetText">Salut!</h2>
    <div id="activeOrderContainer"></div>
    <button onclick="window.logOut()" style="color:#555; background:none; border:none; cursor:pointer; margin-top:15px;">Logout</button>
</div>

<section class="hero" id="hero">
    <h1>Expertiza ta √Æn Tech.</h1>
    <p>Repara»õii profesionale »ôi mentenan»õƒÉ de √ÆnaltƒÉ precizie.</p>
</section>

<section class="services" id="services">
    <div class="price-card">
        <h3>Schimb Baterie</h3>
        <div class="cost">75 <span>RON</span></div>
        <button class="btn-p" onclick="window.placeOrder('Schimb Baterie')">Book Now</button>
    </div>
    <div class="price-card">
        <h3>Schimb Ecran</h3>
        <div class="cost">100 <span>RON</span></div>
        <button class="btn-p" onclick="window.placeOrder('Schimb Ecran')">Book Now</button>
    </div>
    <div class="price-card">
        <h3>Mentenan»õƒÉ Laptop/PC</h3>
        <div class="cost">150 <span>RON</span></div>
        <button class="btn-p" onclick="window.placeOrder('Mentenan»õƒÉ PC')">Book Now</button>
    </div>
    <div class="price-card">
        <h3>Mentenan»õƒÉ ConsolƒÉ</h3>
        <div class="cost">120 <span>RON</span></div>
        <button class="btn-p" onclick="window.placeOrder('Mentenan»õƒÉ ConsolƒÉ')">Book Now</button>
    </div>
</section>

<section class="reviews-section" id="reviews">
    <h2 style="text-align: center; margin-bottom: 40px;">Ce spun clien»õii</h2>
    
    <div id="reviewForm" class="review-form">
        <h3>LasƒÉ o recenzie</h3>
        <select id="revStars">
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Excelent)</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (Foarte Bun)</option>
            <option value="3">‚≠ê‚≠ê‚≠ê (Bun)</option>
        </select>
        <textarea id="revText" placeholder="Spune-ne pƒÉrerea ta..."></textarea>
        <button class="btn-p" onclick="window.postReview()">PosteazƒÉ Recenzia</button>
    </div>

    <div id="reviewsList">
        </div>
</section>

<div id="authModal">
    <div class="modal-content">
        <span class="close-btn" onclick="window.closeModal()">&times;</span>
        <h2 id="m-title">Login</h2>
        <input type="text" id="regUser" placeholder="Nume utilizator" style="display:none;">
        <input type="email" id="uEmail" placeholder="Email">
        <input type="password" id="uPass" placeholder="Parola">
        <button class="btn-p" id="m-btn" onclick="window.handleAuth()">IntrƒÉ √Æn cont</button>
        <p id="m-toggle" style="font-size:12px; color:var(--secondary); cursor:pointer; margin-top:20px;" onclick="window.toggleAuth()">Nu ai cont? CreeazƒÉ unul</p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB9xuQD_cvxult5OoRqnrxFbnV4GRqKyNY",
  authDomain: "vice-service.firebaseapp.com",
  projectId: "vice-service",
  storageBucket: "vice-service.firebasestorage.app",
  messagingSenderId: "17358293881",
  appId: "1:17358293881:web:7691b91c7d7f0a65bffda8",
  measurementId: "G-20WM0K9WBL"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let isSignUp = false;
    let currentUserData = null;

    window.openModal = () => document.getElementById('authModal').style.display = 'flex';
    window.closeModal = () => document.getElementById('authModal').style.display = 'none';

    window.toggleAuth = () => {
        isSignUp = !isSignUp;
        document.getElementById('m-title').innerText = isSignUp ? "Sign Up" : "Login";
        document.getElementById('regUser').style.display = isSignUp ? "block" : "none";
        document.getElementById('m-btn').innerText = isSignUp ? "CreeazƒÉ Cont" : "IntrƒÉ √Æn cont";
    };

    window.handleAuth = async () => {
        const email = document.getElementById('uEmail').value;
        const pass = document.getElementById('uPass').value;
        const username = document.getElementById('regUser').value;
        try {
            if (isSignUp) {
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await setDoc(doc(db, "users", res.user.uid), { username: username });
            } else {
                await signInWithEmailAndPassword(auth, email, pass);
            }
            window.closeModal();
        } catch (e) { alert(e.message); }
    };

    window.logOut = () => signOut(auth).then(() => location.reload());

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const snap = await getDoc(doc(db, "users", user.uid));
            currentUserData = snap.exists() ? snap.data() : { username: "Client" };
            
            document.getElementById('loginNavBtn').style.display = 'none';
            document.getElementById('reviewForm').style.display = 'block'; // Users can now post

            if (user.email === "mariooncica@yahoo.com") {
                showAdmin();
            } else {
                document.getElementById('userDash').style.display = 'block';
                document.getElementById('greetText').innerText = "Salut, " + currentUserData.username;
                listenOrder(user.uid);
            }
        }
        loadReviews();
    });

    // üì± PLACE ORDER & OPEN WHATSAPP
    window.placeOrder = async (type) => {
        if (!auth.currentUser) return window.openModal();
        
        await setDoc(doc(db, "orders", auth.currentUser.uid), {
            type, username: currentUserData.username, status: "√én Lucru", timestamp: Date.now()
        });

        const phone = "407XXXXXXXX"; // PUT YOUR REAL PHONE NUMBER HERE (ex: 40712345678)
        const message = `Salut Mario! Sunt ${currentUserData.username} »ôi a»ô vrea sƒÉ programez: ${type}.`;
        window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
    };

    // ‚≠ê POST REVIEW
    window.postReview = async () => {
        const text = document.getElementById('revText').value;
        const stars = document.getElementById('revStars').value;
        if(!text) return alert("Scrie ceva √Æn recenzie!");

        await addDoc(collection(db, "reviews"), {
            username: currentUserData.username,
            text: text,
            stars: stars,
            timestamp: Date.now()
        });
        document.getElementById('revText').value = "";
        alert("Recenzie adƒÉugatƒÉ!");
    };

    function loadReviews() {
        const q = query(collection(db, "reviews"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snap) => {
            const list = document.getElementById('reviewsList');
            list.innerHTML = "";
            snap.forEach(d => {
                const r = d.data();
                list.innerHTML += `
                    <div class="review-box">
                        <div class="stars">${"‚≠ê".repeat(r.stars)}</div>
                        <p>"${r.text}"</p>
                        <small style="color:var(--primary)">- ${r.username}</small>
                    </div>`;
            });
        });
    }

    function listenOrder(uid) {
        onSnapshot(doc(db, "orders", uid), (d) => {
            if (d.exists()) {
                const o = d.data();
                const badge = o.status === 'Finalizat' ? 'bg-done' : 'bg-work';
                document.getElementById('activeOrderContainer').innerHTML = `
                    <p>Status Reparatie (${o.type}): <span class="badge ${badge}">${o.status}</span></p>`;
            }
        });
    }

    function showAdmin() {
        document.getElementById('adminPanel').style.display = 'block';
        onSnapshot(collection(db, "orders"), (snap) => {
            const list = document.getElementById('adminOrderList');
            list.innerHTML = "";
            snap.forEach(d => {
                const o = d.data();
                list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #222; display:flex; justify-content:space-between; align-items:center;">
                    <span>${o.username}: ${o.type}</span>
                    <button onclick="window.finish('${d.id}')" style="background:var(--secondary); border:none; padding:5px; border-radius:4px; cursor:pointer;">FINALIZAT</button>
                </div>`;
            });
        });
    }

    window.finish = async (id) => {
        await updateDoc(doc(db, "orders", id), { status: "Finalizat" });
    };
</script>
</body>
</html>
